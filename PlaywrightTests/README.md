# Playwright + C# (MSTest) Scaffold

[![Release](https://img.shields.io/github/v/release/lkumarra/playwright-automation-csharp)](https://github.com/lkumarra/playwright-automation-csharp/releases) [![Actions Status](https://github.com/lkumarra/playwright-automation-csharp/actions/workflows/ci.yml/badge.svg)](https://github.com/lkumarra/playwright-automation-csharp/actions) [![Repo](https://img.shields.io/badge/repo-GitHub-blue.svg)](https://github.com/lkumarra/playwright-automation-csharp)

Repository: https://github.com/lkumarra/playwright-automation-csharp.git

Badges above are examples â€” the Actions badge points at `actions/workflows/ci.yml`. If you add a GitHub Actions workflow, update the workflow filename or the badge URL.

This repository contains a small MSTest-based scaffold that demonstrates using Microsoft.Playwright with C#.

Quick status (run from repository root):

- Build: dotnet build
- Tests: dotnet test
- Test results (TRX): `PlaywrightTests/TestResults/TestResults.trx` (generated by the test run)

Prerequisites
- .NET SDK 8 or 9 installed (this scaffold targets `net9.0` in `PlaywrightTests.csproj`). Use `dotnet --version` to verify.
- Optional: Git (for cloning) and a shell (zsh on macOS is used in examples below).

Install Playwright browsers (one-time)
1. Install the Playwright CLI global tool (if not already installed):

```bash
dotnet tool install --global Microsoft.Playwright.CLI
```

2. Ensure your dotnet tools location is on your PATH. If you see `zsh: command not found: playwright` add the following to `~/.zshrc`:

```bash
export PATH="$PATH:$HOME/.dotnet/tools"
```

Then open a new terminal or run `source ~/.zshrc`.

3. From the `PlaywrightTests` project directory run the Playwright installer to download browser binaries:

```bash
cd PlaywrightTests
playwright install
```

If `playwright` still isn't found, you can run the CLI via dotnet: `dotnet tool run --tool-path ~/.dotnet/tools Microsoft.Playwright.CLI -- install` or run the `playwright` executable from `~/.dotnet/tools` directly.

Restore, build and run tests
From the repository root:

```bash
dotnet restore
dotnet build
dotnet test --logger "trx;LogFileName=TestResults.trx"
```

This will place a test results file at `PlaywrightTests/TestResults/TestResults.trx` (and also in the default TestResults subfolders).

Running specific tests
- Run tests in a single project: cd into `PlaywrightTests` and run `dotnet test`.
- Run a single test by name:

```bash
dotnet test --filter "FullyQualifiedName~Namespace.ClassName.TestMethodName"
```

Enabling UI tests (PLAYWRIGHT_RUN_UI)
-----------------------------------
By default the UI tests in this scaffold are gated behind an environment variable so they don't run during quick runs or CI unintentionally. Set `PLAYWRIGHT_RUN_UI=1` to enable UI tests when running `dotnet test`.

Examples (zsh):

# Run the full solution tests including UI tests
PLAYWRIGHT_RUN_UI=1 dotnet test --logger "trx;LogFileName=TestResults.trx"

# Run only the `PlaywrightTests` project and enable UI tests (recommended when debugging UI locally)
cd PlaywrightTests
PLAYWRIGHT_RUN_UI=1 dotnet test -v diag --logger "trx;LogFileName=TestResults.trx"

# Run a single UI test by name
PLAYWRIGHT_RUN_UI=1 dotnet test --filter "FullyQualifiedName~LoginWithValidCredentials" --logger "trx;LogFileName=TestResults.trx"

Notes:
- The test setup currently launches a headed browser (Headless = false) so you'll see the browser window when UI tests run.
- If you prefer not to open a browser when UI tests are disabled, see the section below about preventing browser startup in `BaseTest.Setup()`.

Project structure (short)
- `PlaywrightTests/PlaywrightTests.csproj` - project file (TargetFramework: net9.0)
- `PlaywrightTests/Pages/` - Page objects
- `PlaywrightTests/Tests/` - MSTest test classes (UI and API tests)
- `PlaywrightTests/Apis/` - helper API wrappers
- `PlaywrightTests/Models/` - DTOs used by API tests
- `PlaywrightTests/Helpers/ApiClient` - HTTP client helpers
- `PlaywrightTests/TestResults/` - test run outputs (TRX files)

Notes and troubleshooting
- If tests require browsers, ensure `playwright install` was run after you installed the CLI tool.
- If global dotnet tools aren't in your PATH, use `dotnet tool list -g` to confirm installation location and update PATH.
- When running tests in CI, add steps to install the .NET SDK and run `dotnet tool install --global Microsoft.Playwright.CLI` and `playwright install` before `dotnet test`.

Contact / Next steps
- Add any project-specific notes here (test categories, environment variables for API endpoints, credentials location, etc.).

Docker & CI (Jenkins)
---------------------
There is a `Dockerfile` at the repository root that builds the project, installs the Playwright CLI and browser dependencies, and runs `dotnet test` by default.

Build and run locally:

```bash
# from repository root
docker build -t playwright-tests:latest .
# run with UI tests enabled (the container runs dotnet test by default)
docker run --rm -e PLAYWRIGHT_RUN_UI=1 playwright-tests:latest
```

Notes for running in CI (Jenkins)
- A sample `Jenkinsfile` is included at the repository root. It builds the Docker image and runs it with `PLAYWRIGHT_RUN_UI=1`.
- The Jenkins pipeline attempts to copy the `PlaywrightTests/TestResults` folder from the image to `test-output` and archives artifacts. You may need to adjust paths or mount a workspace volume depending on your Jenkins agent setup.

Adjust the Dockerfile if your Jenkins agent requires a specific base image or credentials. If your CI environment cannot run headed browsers, consider switching Playwright to headless in `BaseTest.Setup()` or use a headless-capable image.

